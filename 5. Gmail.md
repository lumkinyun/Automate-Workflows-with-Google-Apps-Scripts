
Populate Email into Google Sheet

```js
function listUnreadEmailsToSheet() {
  // Open or create a Google Sheet
  const spreadsheet = SpreadsheetApp.create(`Unread Emails`);
  const sheet = spreadsheet.getActiveSheet();

  // Clear the sheet before populating new data
  sheet.clear();

  // Add headers to the sheet
  sheet.appendRow([ 'Thread ID', 'Sender Name', 'Sender Email', 'Email Content']);

  // Get the first 5 unread emails
  const threads = GmailApp.getInboxThreads(0, 5); // Get the first 5 threads
  const unreadEmails = threads.flatMap(thread => thread.getMessages().filter(msg => msg.isUnread()));

  unreadEmails.forEach(email => {
    const sender = email.getFrom();
    const subject = email.getSubject();
    const body = email.getPlainBody();
    const threadId = email.getThread().getId(); // Get the thread ID

    // Extract sender name and email
    const senderMatch = sender.match(/(.*)<(.*)>/);
    const senderName = senderMatch ? senderMatch[1].trim() : 'Unknown';
    const senderEmail = senderMatch ? senderMatch[2].trim() : sender;

    // Append the data to the sheet
    sheet.appendRow([threadId, senderName, senderEmail, body]);
  });

  // Log the URL of the active spreadsheet
  const sheetUrl = spreadsheet.getUrl();
  Logger.log('Unread emails have been added to the sheet. Sheet URL: ' + sheetUrl);
}
```

Call Gemini to reply the message

```js
const properties = PropertiesService.getScriptProperties().getProperties();
const geminiApiKey = properties['GOOGLE_API_KEY'];
const geminiEndpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiApiKey}`;


function replyEmailsToDraft() {
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    const data = sheet.getDataRange().getValues(); // Get all data from the sheet
    const threadIdColumnIndex = 0; // Column A (zero-based index is 0)
    const emailContentColumnIndex = 3; // Column D (zero-based index is 3)
    const replyColumnIndex = 4; // Column E (zero-based index is 4)
  
    for (let i = 1; i < data.length; i++) { // Start from row 2 (index 1) to skip headers
      const threadId = data[i][threadIdColumnIndex];
      const emailContent = data[i][emailContentColumnIndex];
  
      if (threadId && emailContent) {
        const reply = callGemini(emailContent); // Generate reply using callGemini function
  
        // Save the reply in Column E
        sheet.getRange(i + 1, replyColumnIndex + 1).setValue(reply);
  
        // Save the reply draft in Gmail
        const thread = GmailApp.getThreadById(threadId);
        if (thread) {
          thread.createDraftReply(reply, {
            htmlBody: reply
          });
        }
      }
    }
  }
  
  function callGemini(emailContent, temperature = 0) {
    const payload = {
      "contents": [
        {
          "parts": [
            {
              "text": `This is my email content: """ ${emailContent} """. Reply politely and professionally. Discard all previous email contents. Just give me the reply text. Do not include my own signature.\n`
            },
          ]
        }
      ],
      "generationConfig": {
        "temperature": temperature,
      },
    };
  
    const options = {
      'method': 'post',
      'contentType': 'application/json',
      'payload': JSON.stringify(payload)
    };
  
    const response = UrlFetchApp.fetch(geminiEndpoint, options);
    const data = JSON.parse(response);
    const content = data["candidates"][0]["content"]["parts"][0]["text"];
    return content;
  }
  
  


```